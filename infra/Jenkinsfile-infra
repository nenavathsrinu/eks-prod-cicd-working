pipeline {
  agent any

  stages {

    stage('⚠️ Confirm Destroy') {
      steps {
        input message: 'Are you SURE you want to DESTROY infrastructure?'
      }
    }

    stage('Checkout Infra Code') {
      steps {
        git branch: 'main',
            url: 'https://github.com/nenavathsrinu/eks-prod-cicd-working.git'
      }
    }

    stage('Terraform Init') {
      steps {
        withCredentials([
          [$class: 'AmazonWebServicesCredentialsBinding', credentialsId: 'aws-cred']
        ]) {
          bat '''
          cd infra
          terraform init -input=false
          '''
        }
      }
    }

    stage('Terraform Destroy (Final Approval)') {
      steps {
        input message: 'FINAL WARNING: This will DELETE all resources. Continue?'
        withCredentials([
          [$class: 'AmazonWebServicesCredentialsBinding', credentialsId: 'aws-cred']
        ]) {
          bat '''
          cd infra
          terraform destroy -auto-approve
          '''
        }
      }
    }
  }
}
